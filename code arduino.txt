#include <OneWire.h>              // Library for 1-Wire communication protocol
#include <DallasTemperature.h>    // Library for DS18B20 temperature sensor

#define ORP_PIN A0                 // Analog pin for ORP sensor
#define PH_PIN A2                  // Analog pin for pH sensor
#define ONE_WIRE_BUS A3            // Data pin for DS18B20 temperature sensor

// Create a OneWire instance for DS18B20 communication
OneWire oneWire(ONE_WIRE_BUS);

// Pass the OneWire reference to the DallasTemperature library
DallasTemperature sensors(&oneWire);

void setup() {
  Serial.begin(9600); // Initialize serial communication at 9600 baud

  // Send sensor announcement once at startup
  Serial.println("{Sensor Temperature, Sensor pH, Sensor ORP Meter}");
  delay(1000);  // Give time for the Java program or other receiver to process the announcement

  // Initialize the DS18B20 temperature sensor
  sensors.begin();
}

void loop() {
  // Periodic sensor announcement (could be used as a header for the data stream)
  Serial.println("{Sensor Temperature, Sensor pH, Sensor ORP Meter}");

  // --- ORP Sensor Reading ---
  int orpRawValue = analogRead(ORP_PIN);                // Read raw ADC value
  float orpVoltage = orpRawValue * 5.0 / 1023.0;        // Convert ADC to voltage (assuming 5V reference)
  float orpValue = (2.5 - orpVoltage) * 1000;           // Convert voltage to ORP in millivolts (approximation)

  // --- pH Sensor Reading ---
  int phRawValue = analogRead(PH_PIN);                  // Read raw ADC value
  float phVoltage = phRawValue * 5.0 / 1023.0;          // Convert ADC to voltage
  float pH = -5.7 * phVoltage + 21.42;                  // Convert voltage to pH value (calibration formula)

  // --- Temperature Sensor Reading ---
  sensors.requestTemperatures();                        // Request temperature measurement
  float temperatureC = sensors.getTempCByIndex(0);      // Get temperature in °C from first sensor

  // --- Send formatted sensor data ---
  // Temperature
  Serial.print("[Sensor Temperature, DFRobot, Waterproof DS18B20, TEMP-SN-001, 2024-04-05, ");
  Serial.print(temperatureC, 2);                        // Two decimal places
  Serial.print(", °C, temperature] / ");

  // pH
  Serial.print("[Sensor pH, DFRobot, pH Meter V2.0, PH-SN-002, 2024-04-06, ");
  Serial.print(pH, 2);
  Serial.print(", , pH] / ");

  // ORP
  Serial.print("[Sensor ORP Meter, DFRobot, SEN0165, 42W6-SEN0165, 2024-04-06, ");
  Serial.print(orpValue, 2);
  Serial.println(", mV, redox potential]");

  delay(1000); // Wait 1 second before next reading
}
